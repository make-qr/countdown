
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>60-Minute Casio Countdown (Working)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
body{background:#000;color:#fff;font-family:'Orbitron',monospace}
.casio-font{font-family:'Orbitron','Courier New',monospace;font-weight:900;letter-spacing:0.1em}
.btn{@apply px-6 py-3 rounded-lg font-bold transition-all duration-200}
.btn-primary{@apply bg-green-600 hover:bg-green-500 text-white}
.progress-bar{@apply w-full h-4 bg-gray-800 rounded-full overflow-hidden}
.progress-fill{@apply h-full bg-green-500 transition-all duration-300}
#renderCanvas{position:absolute;top:-9999px;left:-9999px} /* Hide render canvas */
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
<div class="w-full max-w-2xl text-center space-y-6">
	<h1 class="text-4xl font-bold casio-font text-green-400 mb-8">
		‚è±Ô∏è CASIO 60-MINUTE COUNTDOWN
	</h1>
	
	<div class="bg-gray-900 p-8 rounded-2xl border border-gray-700">
		<div class="grid grid-cols-2 gap-6 mb-6">
			<div>
				<label class="block text-sm font-semibold mb-2 text-gray-300">Ch·∫•t l∆∞·ª£ng:</label>
				<select id="quality" class="w-full p-3 rounded bg-black border border-gray-600 text-white casio-font">
					<option value="720p">1280√ó720 (HD - Nhanh)</option>
					<option value="1080p" selected>1920√ó1080 (Full HD)</option>
					<option value="1440p">2560√ó1440 (2K)</option>
				</select>
			</div>
			<div>
				<label class="block text-sm font-semibold mb-2 text-gray-300">FPS:</label>
				<select id="fps" class="w-full p-3 rounded bg-black border border-gray-600 text-white casio-font">
					<option value="24">24 FPS</option>
					<option value="30" selected>30 FPS</option>
				</select>
			</div>
		</div>
		
		<button id="generate" class="btn btn-primary w-full text-xl casio-font">
			üöÄ T·∫†O VIDEO 60 PH√öT
		</button>
		
		<div class="mt-4 text-sm text-gray-400">
			‚ö° Th·ªùi gian t·∫°o: ~2-5 ph√∫t (t√πy c·∫•u h√¨nh m√°y)
		</div>
	</div>
	
	<div id="progress-section" class="bg-gray-900 p-6 rounded-xl border border-gray-700 hidden">
		<div class="flex justify-between items-center mb-4">
			<span class="casio-font text-green-400">ƒêANG X·ª¨ L√ù...</span>
			<span id="progress-text" class="casio-font text-white">0%</span>
		</div>
		<div class="progress-bar">
			<div id="progress-fill" class="progress-fill" style="width:0%"></div>
		</div>
		<div class="mt-4 space-y-2 text-sm">
			<div class="flex justify-between">
				<span>Tr·∫°ng th√°i:</span>
				<span id="status" class="text-green-400">Kh·ªüi t·∫°o...</span>
			</div>
			<div class="flex justify-between">
				<span>Th·ªùi gian c√≤n l·∫°i:</span>
				<span id="eta" class="text-yellow-400">ƒêang t√≠nh...</span>
			</div>
		</div>
	</div>
	
	<div id="preview-section" class="bg-gray-900 p-6 rounded-xl border border-gray-700 hidden">
		<h3 class="text-xl font-bold casio-font text-green-400 mb-4">‚úÖ HO√ÄN TH√ÄNH!</h3>
		<video id="preview" controls class="w-full rounded-lg mb-4"></video>
		<button id="download" class="btn btn-primary casio-font">
			üíæ T·∫¢I XU·ªêNG VIDEO
		</button>
		<div class="mt-4 text-sm text-gray-400">
			Video: 60 ph√∫t | Font: Casio Digital | Ch·∫•t l∆∞·ª£ng cao
		</div>
	</div>
</div>

<!-- Hidden canvas for rendering -->
<canvas id="renderCanvas"></canvas>

<script>
const $ = id => document.getElementById(id);
const btn = $("generate"), progressSection = $("progress-section"), previewSection = $("preview-section");
const progressFill = $("progress-fill"), progressText = $("progress-text"), status = $("status"), eta = $("eta");
const preview = $("preview");

btn.onclick = async () => {
	const quality = $("quality").value;
	const fps = +$("fps").value;
	
	// Resolution settings
	const resolutions = {
		"720p": {w: 1280, h: 720},
		"1080p": {w: 1920, h: 1080},
		"1440p": {w: 2560, h: 1440}
	};
	const {w, h} = resolutions[quality];
	
	btn.disabled = true;
	progressSection.classList.remove("hidden");
	previewSection.classList.add("hidden");
	
	const duration = 3600; // 60 minutes = 3600 seconds
	let startTime = performance.now();
	
	try {
		// Setup canvas for drawing (regular canvas, not OffscreenCanvas)
		const canvas = $("renderCanvas");
		canvas.width = w;
		canvas.height = h;
		const ctx = canvas.getContext("2d");
		
		// Preload font
		await document.fonts.load("900 " + (h/5) + "px 'Courier New'");
		
		// MediaRecorder setup
		const stream = canvas.captureStream(fps);
		const chunks = [];
		
		const mediaRecorder = new MediaRecorder(stream, {
			mimeType: 'video/webm; codecs=vp9',
			videoBitsPerSecision: w >= 2560 ? 8000000 : w >= 1920 ? 5000000 : 3000000
		});
		
		mediaRecorder.ondataavailable = event => {
			if (event.data.size > 0) {
				chunks.push(event.data);
			}
		};
		
		mediaRecorder.onstop = () => {
			const blob = new Blob(chunks, { type: 'video/webm' });
			const url = URL.createObjectURL(blob);
			
			preview.src = url;
			preview.load();
			
			$("download").onclick = () => {
				const a = document.createElement("a");
				a.href = url;
				a.download = `casio-countdown-60min-${quality}-${fps}fps.webm`;
				a.click();
			};
			
			// Show completion
			progressFill.style.width = "100%";
			progressText.textContent = "100%";
			status.textContent = "Ho√†n th√†nh!";
			eta.textContent = "00:00";
			
			previewSection.classList.remove("hidden");
			btn.disabled = false;
			
			const totalTime = (performance.now() - startTime) / 1000;
			console.log(`‚úÖ Video generated in ${totalTime.toFixed(1)} seconds`);
		};
		
		// Casio-style drawing function
		const drawCasioFrame = (timeRemaining) => {
			// Pure black background
			ctx.fillStyle = "#000000";
			ctx.fillRect(0, 0, w, h);
			
			// Calculate time display (MM:SS format)
			const totalMins = Math.floor(timeRemaining / 60);
			const secs = timeRemaining % 60;
			const timeString = `${totalMins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
			
			// Main Casio-style time display
			const fontSize = Math.min(w, h) / 5;
			ctx.font = `900 ${fontSize}px 'Courier New', monospace`;
			ctx.textAlign = "center";
			ctx.textBaseline = "middle";
			ctx.fillStyle = "#FFFFFF";
			
			// Add subtle glow for Casio LCD effect
			ctx.shadowColor = "#FFFFFF";
			ctx.shadowBlur = 8;
			ctx.fillText(timeString, w/2, h/2);
			
			// Reset shadow
			ctx.shadowBlur = 0;
			
			// Add small LCD-style indicators
			ctx.font = `400 ${fontSize/15}px 'Courier New', monospace`;
			ctx.fillStyle = "#999999";
			ctx.fillText("MIN    SEC", w/2, h/2 + fontSize/2.2);
			
			// Simple progress indicator at bottom
			const progressWidth = w * 0.8;
			const progressHeight = 6;
			const progressX = (w - progressWidth) / 2;
			const progressY = h * 0.85;
			
			// Progress background
			ctx.fillStyle = "#333333";
			ctx.fillRect(progressX, progressY, progressWidth, progressHeight);
			
			// Progress fill
			const fillWidth = ((duration - timeRemaining) / duration) * progressWidth;
			ctx.fillStyle = "#FFFFFF";
			ctx.fillRect(progressX, progressY, fillWidth, progressHeight);
		};
		
		// Start recording
		mediaRecorder.start();
		status.textContent = "ƒêang render frames...";
		
		// Generate frames using RAF for smooth timing
		let currentTime = duration;
		let frameCount = 0;
		const targetFrameTime = 1000 / fps; // ms per frame
		let lastFrameTime = 0;
		
		const generateFrame = (timestamp) => {
			if (currentTime >= 0) {
				// Control frame rate
				if (timestamp - lastFrameTime >= targetFrameTime) {
					drawCasioFrame(currentTime);
					
					// Update progress every second
					if (frameCount % fps === 0) {
						const progress = ((duration - currentTime) / duration) * 100;
						progressFill.style.width = progress + "%";
						progressText.textContent = progress.toFixed(1) + "%";
						
						const elapsed = (performance.now() - startTime) / 1000;
						const remaining = (elapsed / ((duration - currentTime) / duration)) - elapsed;
						eta.textContent = formatTime(remaining);
						status.textContent = `Rendering: ${Math.floor(currentTime/60)}:${(currentTime%60).toString().padStart(2,'0')}`;
					}
					
					currentTime--;
					frameCount++;
					lastFrameTime = timestamp;
				}
				
				requestAnimationFrame(generateFrame);
			} else {
				// Finished generating frames
				setTimeout(() => {
					mediaRecorder.stop();
				}, 1000);
			}
		};
		
		requestAnimationFrame(generateFrame);
		
	} catch (error) {
		console.error("Error generating video:", error);
		alert("L·ªói t·∫°o video: " + error.message);
		btn.disabled = false;
		progressSection.classList.add("hidden");
	}
};

// Helper functions
function formatTime(seconds) {
	if (!seconds || seconds < 0) return "00:00";
	const mins = Math.floor(seconds / 60);
	const secs = Math.floor(seconds % 60);
	return `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
}

console.log("üöÄ Working Casio 60-Minute Countdown Generator ready!");
</script>
</body>
</html>
